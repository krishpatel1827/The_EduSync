<!-- 
====================================================================
                    EDUSYNC ADMIN DASHBOARD TEMPLATE
====================================================================
This template provides the main admin interface for institution management.
It includes sections for:
1. News publishing and management
2. Department overview with teacher/student lists
3. Quick actions for administrative tasks
4. Responsive design with custom themes and scrollbars
====================================================================
-->

<!-- 
====================================================================
                    EDUSYNC ADMIN DASHBOARD TEMPLATE
====================================================================
This template provides the main admin interface for institution management.
It includes sections for:
1. News publishing and management
2. Department overview with teacher/student lists
3. Quick actions for administrative tasks
4. Responsive design with custom themes and scrollbars
====================================================================
-->

{% extends "base.html" %}
{% block content %}

<!-- 
====================================================================
                         CSS STYLES SECTION
====================================================================
This section contains all custom CSS for:
- Theme-aware styling (light/dark mode support)
- Component styling (buttons, cards, forms)
- Responsive design and animations
- Custom scrollbars for better UX
====================================================================
-->
<style>
  /* GLOBAL BODY STYLING - Sets minimum height and font family */
  body {
    min-height: 100vh;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  }

  /* üåà PAGE BACKGROUND - Creates gradient background using CSS custom properties */
  .dashboard-wrapper {
    background: linear-gradient(135deg, var(--clr-bg) 0%, var(--clr-surface-alt) 100%);
    min-height: 100vh;
  }

  /* üì∞ NEWS TICKER - Styles for scrolling news display */
  .news-ticker {
    background: var(--clr-surface);
    border-bottom: 2px solid var(--clr-accent);
    padding: 12px 0;
    box-shadow: var(--shadow-sm);
  }

  .news-ticker marquee {
    color: var(--clr-text);
    font-size: 14px;
  }

  /* DASHBOARD HEADER - Main title section with animation */
  .dashboard-header {
    text-align: center;
    padding: 40px 20px 30px;
    animation: fadeInDown 0.6s ease-out;
    /* Slides down on load */
  }

  .dashboard-title {
    color: var(--clr-text);
    font-size: 36px;
    font-weight: 700;
  }

  .dashboard-subtitle {
    color: var(--clr-text-muted);
  }

  /* üßä ADMIN CARDS - Main content containers with glassmorphism effect */
  .admin-card {
    background: var(--clr-surface);
    border-radius: 16px;
    padding: 30px;
    box-shadow: var(--shadow-md);
    border: 1px solid rgba(0, 0, 0, .06);
    backdrop-filter: blur(10px);
    /* Glassmorphism effect */
    transition: .3s;
    animation: slideUp .6s ease-out;
    /* Slides up on load */
    height: 100%;
  }

  /* DARK THEME CARD STYLING - Adjusts border color for dark mode */
  [data-bs-theme="dark"] .admin-card {
    border-color: rgba(255, 255, 255, .08);
  }

  /* CARD HOVER EFFECT - Lifts card slightly on hover */
  .admin-card:hover {
    transform: translateY(-5px);
  }

  /* CARD HEADER */
  .card-header-custom {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
    padding-bottom: 15px;
    border-bottom: 1px solid var(--clr-surface-alt);
  }

  .card-header-custom h5 {
    color: var(--clr-text);
  }

  .card-icon {
    width: 40px;
    height: 40px;
    background: var(--clr-accent-soft);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* CUSTOM INPUT FIELDS - Themed form controls */
  .form-control-custom {
    background: var(--clr-surface-alt);
    border: 1px solid rgba(0, 0, 0, .08);
    border-radius: 10px;
    padding: 12px 15px;
    color: var(--clr-text);
  }

  /* DARK THEME INPUT STYLING */
  [data-bs-theme="dark"] .form-control-custom {
    border-color: rgba(255, 255, 255, .1);
  }

  /* INPUT FOCUS STATE - Highlights active input with accent color */
  .form-control-custom:focus {
    border-color: var(--clr-accent);
    box-shadow: 0 0 0 3px var(--clr-accent-soft);
  }

  /* CUSTOM BUTTON STYLES - Themed buttons for different actions */

  /* PRIMARY BUTTON - Main action button (publish, submit, etc.) */
  .btn-primary-custom {
    background: var(--clr-accent);
    color: #fff;
    border-radius: 10px;
    padding: 10px 25px;
    font-weight: 600;
    border: none;
    cursor: pointer;
    transition: all 0.3s;
    display: inline-block;
    text-decoration: none;
    text-align: center;
  }

  .btn-primary-custom:hover {
    background: var(--clr-accent-hover);
    color: #fff;
  }

  /* OUTLINE BUTTON - Secondary action button (view, edit links) */
  .btn-outline-custom {
    border: 1px solid var(--clr-accent);
    color: var(--clr-accent);
    background: transparent;
    border-radius: 10px;
    padding: 10px 25px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    display: inline-block;
    text-decoration: none;
    text-align: center;
  }

  .btn-outline-custom:hover {
    background: var(--clr-accent-soft);
    color: var(--clr-accent);
  }

  .btn-warning-custom {
    background: var(--clr-gold);
    color: #fff;
    border: none;
    border-radius: 10px;
    padding: 8px 15px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    display: inline-block;
    text-decoration: none;
    font-size: 14px;
    margin-right: 5px;
  }

  .btn-warning-custom:hover {
    opacity: 0.9;
    color: #fff;
  }

  /* DANGER BUTTON - For destructive actions (delete operations) */
  .btn-danger-custom {
    background: var(--clr-danger);
    color: #fff;
    border: none;
    border-radius: 10px;
    padding: 8px 15px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    display: inline-block;
    text-decoration: none;
    font-size: 14px;
  }

  .btn-danger-custom:hover {
    opacity: 0.9;
    color: #fff;
  }

  .btn-success-custom {
    background: var(--clr-green);
    color: #fff;
    border: none;
    border-radius: 10px;
    padding: 10px 25px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    display: inline-block;
    text-decoration: none;
  }

  .btn-success-custom:hover {
    opacity: 0.9;
    color: #fff;
  }

  /* NEWS ITEM */
  .news-item {
    background: var(--clr-surface-alt);
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 12px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .news-item span {
    color: var(--clr-text);
    flex: 1;
    margin-right: 15px;
  }

  .action-buttons {
    display: flex;
    gap: 8px;
    flex-shrink: 0;
  }

  /* QUICK ACTION */
  .quick-action-card {
    background: var(--clr-surface-alt);
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    transition: .3s;
  }

  .quick-action-card:hover {
    background: var(--clr-accent-soft);
    transform: translateY(-3px);
  }

  .quick-action-card h5 {
    color: var(--clr-text);
  }


  /* EMPTY STATE */
  .empty-state {
    text-align: center;
    padding: 30px;
    color: var(--clr-text-muted);
  }


  /* ‚úÖ COLLAPSE FIX - Ensure content shows when expanded */
  .collapse:not(.show) {
    display: none;
  }

  .collapse.show {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
  }

  .collapse.show .card-body {
    display: block !important;
    visibility: visible !important;
  }

  .collapsing {
    position: relative;
    height: 0;
    overflow: hidden;
    transition: height 0.35s ease;
  }

  /* ANIMATIONS */
  @keyframes fadeInDown {
    from {
      opacity: 0;
      transform: translateY(-20px);
    }

    to {
      opacity: 1;
    }
  }

  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }

    to {
      opacity: 1;
    }
  }
</style>



<!-- 
====================================================================
                      MAIN DASHBOARD CONTENT
====================================================================
-->

<!-- DASHBOARD HEADER - Main title and subtitle -->
<!-- 
====================================================================
                      MAIN DASHBOARD CONTENT
====================================================================
-->

<!-- DASHBOARD HEADER - Main title and subtitle for the admin interface -->
<div class="dashboard-header">
  <h3 class="dashboard-title">Institution Admin Dashboard</h3>
  <p class="dashboard-subtitle">Manage your institution's settings and data here</p>
</div>

<div class="container" style="max-width: 1400px; padding-bottom: 50px;">

  <!-- 
  ====================================================================
                        QUICK ACTIONS SECTION
  ====================================================================
  Provides immediate access to common administrative tasks:
  - Publishing and managing news announcements
  - Form for adding/editing news content
  ====================================================================
  -->
  <div class="row g-4 mb-5">
    <div class="col-12">
      <h4 style="color: var(--clr-text); margin-bottom: 20px; font-weight: 600;">‚ö° Quick Actions</h4>
    </div>

    <!-- NEWS PUBLISHING INTERFACE - Allows admins to add/edit news announcements -->
    <div class="col-12">
      <div class="admin-card" style="height: 100%;">
        <div class="card-header-custom">
          <h5>{% if edit_news %}‚úèÔ∏è Edit News{% else %}üì∞ Publish News{% endif %}</h5>
          <div class="card-icon">üì¢</div>
        </div>
        <!-- NEWS FORM - Handles both creating new news and editing existing ones -->
        <form method="post">
          {% csrf_token %}
          <input type="hidden" name="action" value="add_news">
          {% if edit_news %}
          <input type="hidden" name="news_id" value="{{ edit_news.id }}">
          {% endif %}
          <textarea name="news" class="form-control-custom mb-3" rows="3" placeholder="Enter news content here..."
            required>{{ edit_news.content|default_if_none:"" }}</textarea>
          <button class="btn-primary-custom w-100" type="submit">
            {% if edit_news %}‚úì Update News{% else %}‚úì Publish News{% endif %}
          </button>
        </form>
      </div>
    </div>
  </div>

  <!-- 
  ====================================================================
                         NEWS FEED SECTION
  ====================================================================
  Displays all published news with management options:
  - List of all news items with content preview
  - Edit and delete actions for each news item
  - Scrollable container for better UX with many news items
  ====================================================================
  -->
  <div class="row g-4 mb-5">
    <div class="col-12">
      <h4 style="color: var(--clr-text); margin-bottom: 20px; font-weight: 600;">üìã News Feed</h4>
    </div>
    <div class="col-12">
      <div class="admin-card">
        <div class="card-header-custom">
          <h5>Published News</h5>
          <span style="color: var(--clr-text-muted); font-size: 14px;">
            {{ news_list|length }} item{{ news_list|length|pluralize }}
          </span>
        </div>
        <!-- SCROLLABLE NEWS CONTAINER - Limits height and provides scroll for many items -->
        <div style="max-height: 350px; overflow-y: auto; padding-right: 5px;">
          {% if news_list %}
          {% for n in news_list %}
          <!-- INDIVIDUAL NEWS ITEM - Each news entry with edit/delete actions -->
          <div class="news-item">
            <span>{{ n.content }}</span>
            <div class="action-buttons">
              <a href="?edit={{ n.id }}" class="btn-warning-custom">‚úèÔ∏è Edit</a>
              <a href="{% url 'delete_news' n.id %}" class="btn-danger-custom"
                onclick="return confirm('Are you sure you want to delete this news?')">
                üóëÔ∏è Delete
              </a>
            </div>
          </div>
          {% endfor %}
          {% else %}
          <div class="empty-state">
            <div class="empty-state-icon">üì∞</div>
            <p>No news published yet. Add your first news item!</p>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>

<!-- 
====================================================================
                    DEPARTMENTS OVERVIEW SECTION
====================================================================
Main section displaying all departments with:
- Collapsible cards showing department details
- Teacher and student lists with custom scrollbars
- Branch management within departments
- Inline forms for adding branches
- Delete confirmation modals
====================================================================
-->
<div class="container" style="max-width: 1400px; padding-bottom: 50px;">
  <div class="row g-4">
    <!-- DEPARTMENTS HEADER with management link -->
    <div class="col-12 d-flex justify-content-between align-items-center mb-3">
      <h4 style="color: var(--clr-text); font-weight: 600; margin-bottom: 0;">üìö Departments Overview</h4>
      <a href="{% url 'department_list' %}" class="btn-primary-custom"
        style="padding: 8px 20px; font-size: 14px; text-decoration: none;">
        ‚öôÔ∏è Manage Departments
      </a>
    </div>

    {% if departments %}
    {% for dept in departments %}
    <!-- INDIVIDUAL DEPARTMENT CARD -->
    <div class="col-12">
      <div class="admin-card" style="padding: 0; overflow: hidden;">
        <!-- DEPARTMENT CARD HEADER - Clickable header to expand/collapse content -->
        <div class="card-header-custom dept-toggle"
          style="padding: 25px 30px; cursor: pointer; border-bottom: none; margin-bottom: 0; transition: background 0.3s;"
          onmouseover="this.style.background='var(--clr-surface-alt)'" onmouseout="this.style.background='transparent'">

          <div class="d-flex align-items-center justify-content-between w-100">
            <div class="d-flex align-items-center" onclick="toggleDepartment('{{ dept.id }}')">
              <div class="card-icon me-3" style="font-size: 30px;">üè¢</div>
              <div>
                <h5 class="mb-1" style="font-weight: 600;">{{ dept.name }}</h5>
                <small style="color: var(--clr-text-muted); font-size: 18px;">
                  <span style="margin-right: 15px;">
                    üë®‚Äçüè´ {{ dept.teacher_set.count }} Teacher{{ dept.teacher_set.count|pluralize }}
                  </span>
                  <span>
                    üìÇ {{ dept.branch_set.count }} Branch{{ dept.branch_set.count|pluralize:"es" }}
                  </span>
                </small>
              </div>
            </div>
            <div class="d-flex align-items-center gap-2">
              <button type="button" class="btn-danger-custom"
                style="padding: 6px 12px; font-size: 18px; border-radius: 8px;" data-dept-id="{{ dept.id }}"
                data-dept-name="{{ dept.name }}" data-teacher-count="{{ dept.teacher_set.count }}"
                data-branch-count="{{ dept.branch_set.count }}"
                onclick="event.stopPropagation(); deleteDeptButtonClick(this);">
                üóëÔ∏è Delete
              </button>
              <span class="badge" id="badge-{{ dept.id }}" onclick="toggleDepartment('{{ dept.id }}')"
                style="background: var(--clr-accent); color: white; padding: 8px 16px; border-radius: 20px; font-size: 18px; cursor: pointer;">
                Click to Expand ‚ñº
              </span>
            </div>
          </div>
        </div>

        <!-- COLLAPSIBLE DEPARTMENT CONTENT - Hidden by default, shows teachers and students -->
        <div class="dept-content" id="deptContent{{ dept.id }}" style="display: none;">
          <div class="card-body"
            style="padding: 30px; background: var(--clr-surface-alt); border-top: 1px solid rgba(0,0,0,0.1);">

            <div class="row g-4">
              <!-- 
              ********************************************************
                              TEACHERS LIST SECTION
              ********************************************************
              Displays all teachers assigned to this department:
              - Custom scrollable container with theme-aware scrollbars
              - Teacher cards with name, ID, and edit links
              - Enhanced typography for better readability
              ********************************************************
              -->
              <div class="col-md-6">
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <h6 class="text-uppercase mb-0"
                    style="color: var(--clr-text-muted); font-weight: 700 ; font-size: large;">
                    üë®‚Äçüè´ Teachers
                  </h6>
                  <span class="badge bg-secondary" style="font-size: 10px;">{{ dept.teacher_set.count }}</span>
                </div>
                {% if dept.teacher_set.all %}
                <div class="list-group list-group-flush teacher-list-scroll"
                  style="max-height: 420px; overflow-y: auto; background: var(--clr-surface-alt); border-radius: 12px; box-shadow: var(--shadow-md); padding: 8px;">
                  <style>
                    .teacher-list-scroll::-webkit-scrollbar {
                      width: 12px;
                      background: transparent;
                    }

                    .teacher-list-scroll::-webkit-scrollbar-thumb {
                      background: var(--clr-accent);
                      border-radius: 10px;
                      border: 2px solid var(--clr-surface-alt);
                    }

                    .teacher-list-scroll::-webkit-scrollbar-track {
                      background: var(--clr-surface-alt);
                      border-radius: 10px;
                    }

                    .teacher-list-scroll {
                      scrollbar-width: thin;
                      scrollbar-color: var(--clr-accent) var(--clr-surface-alt);
                    }

                    @media (max-width: 768px) {
                      .teacher-list-scroll {
                        max-height: 220px;
                        padding: 4px;
                      }
                    }
                  </style>
                  {% for teacher in dept.teacher_set.all %}
                  <div class="list-group-item d-flex justify-content-between align-items-center"
                    style="background: var(--clr-surface); color: var(--clr-text); border: 1px solid rgba(0,0,0,0.05); border-radius: 8px; margin-bottom: 8px; padding: 18px; font-size: 18px;">
                    <div>
                      <strong style="font-size: 18px;">{{ teacher.name|default:teacher.user.username }}</strong>
                      <br>
                      <span style="font-size: 14px; color: var(--clr-text-muted);">ID: {{ teacher.employee_id }}</span>
                    </div>
                    <a href="{% url 'teacher_edit' teacher.id %}" class="btn-sm btn-outline-custom"
                      style="padding: 6px 16px; font-size: 14px; text-decoration: none;">View</a>
                  </div>
                  {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-4" style="color: var(--clr-text-muted);">
                  <p class="mb-0" style="font-size: 13px;">No teachers assigned yet</p>
                </div>
                {% endif %}
              </div>

              <!-- 
              ********************************************************
                        STUDENTS LIST SECTION (Grouped by Branch)
              ********************************************************
              Displays students organized by their branches:
              - Nested structure: Department > Branch > Students
              - Custom scrollable containers for long lists
              - Inline form for adding new branches
              - Student cards with academic details
              ********************************************************
              -->
              <div class="col-md-6">
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <h6 class="text-uppercase mb-0"
                    style=" color: var(--clr-text-muted); font-weight: 700; font-size: large;">
                    üë®‚Äçüéì Students by Branch
                  </h6>
                  <button class="btn-sm btn-success-custom" style=" border-radius: 6px;"
                    onclick="toggleBranchForm('{{ dept.id }}');">
                    + Add Branch
                  </button>
                </div>

                <!-- INLINE BRANCH FORM - Hidden form for adding new branches to department -->
                <div id="addBranchForm{{ dept.id }}" style="display: none; margin-bottom: 15px;">
                  <div
                    style="background: var(--clr-surface); padding: 15px; border-radius: 10px; border: 1px solid var(--clr-accent);">
                    <h6 style="color: var(--clr-text); font-weight: 600; margin-bottom: 10px; font-size: 13px;">Add
                      Branch to {{ dept.name }}</h6>
                    <form method="post">
                      {% csrf_token %}
                      <input type="hidden" name="action" value="add_branch">
                      <input type="hidden" name="dept_id" value="{{ dept.id }}">
                      <input type="text" name="branch_name" class="form-control-custom w-100 mb-2"
                        placeholder="e.g. AI & ML" required>
                      <div class="d-flex gap-2">
                        <button type="submit" class="btn-success-custom" style="padding: 6px 16px; font-size: 12px;">Add
                          Branch</button>
                        <button type="button" class="btn-outline-custom" style="padding: 6px 16px; font-size: 12px;"
                          onclick="toggleBranchForm('{{ dept.id }}');">Cancel</button>
                      </div>
                    </form>
                  </div>
                </div>

                {% if dept.branch_set.all %}
                <div class="branch-list-scroll"
                  style="max-height: 400px; overflow-y: auto; background: var(--clr-surface-alt); border-radius: 12px; box-shadow: var(--shadow-md); padding: 8px; margin-bottom: 16px;">
                  {% for branch in dept.branch_set.all %}
                  <div class="mb-3"
                    style="background: var(--clr-surface); padding: 15px; border-radius: 8px; border: 1px solid rgba(0,0,0,0.05);">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                      <strong style="color: var(--clr-accent); font-size: 20px;">üìÇ {{ branch.name }}</strong>
                      <span class="badge bg-info" style="font-size: medium; ">
                        {{ branch.student_set.count }} student{{ branch.student_set.count|pluralize }}
                      </span>
                    </div>
                    {% if branch.student_set.all %}
                    <div class="list-group list-group-flush student-list-scroll"
                      style="max-height: 320px; overflow-y: auto; background: var(--clr-surface-alt); border-radius: 10px; padding: 4px; margin-bottom: 8px;">
                      {% for student in branch.student_set.all %}
                      <div class="list-group-item d-flex justify-content-between align-items-center"
                        style="background: transparent; color: var(--clr-text); border: none; border-bottom: 1px solid rgba(0,0,0,0.05); padding: 14px 0; font-size: 18px;">
                        <div style="flex: 1;">
                          <strong style="font-size: 18px;">{{ student.name|default:student.user.username }}</strong>
                          <br>
                          <span style="font-size: 14px; color: var(--clr-text-muted);">
                            Year: {{ student.academic_year|default:"N/A" }} ‚Ä¢ ID: {{ student.student_id }} ‚Ä¢ Sem: {{ student.semester }} ‚Ä¢ Blood: {{ student.blood_group|default:"-" }}
                          </span>
                        </div>
                        <div style="text-align: right; margin-right: 15px; min-width: 90px;">
                          <div style="font-size: 12px; color: var(--clr-text-muted); margin-bottom: 3px;">Grade</div>
                          {% with marks=student.marksheets.all|first %}
                          {% if marks %}
                          <span style="font-size: 16px; font-weight: 700; color: var(--clr-accent);">{{ marks.final_grade }}</span>
                          {% else %}
                          <span style="font-size: 14px; color: var(--clr-text-muted);">‚Äî</span>
                          {% endif %}
                          {% endwith %}
                        </div>
                        <a href="{% url 'student_edit' student.id %}" class="btn-sm btn-outline-custom"
                          style="padding: 6px 16px; font-size: 14px; text-decoration: none;">View</a>
                        <!-- ...existing code... -->
                        <style>
                          .teacher-list-scroll::-webkit-scrollbar,
                          .student-list-scroll::-webkit-scrollbar,
                          .branch-list-scroll::-webkit-scrollbar {
                            width: 12px;
                            background: transparent;
                          }

                          .teacher-list-scroll::-webkit-scrollbar-thumb,
                          .student-list-scroll::-webkit-scrollbar-thumb,
                          .branch-list-scroll::-webkit-scrollbar-thumb {
                            background: linear-gradient(135deg, var(--clr-scrollbar-thumb1, #6a82fb) 0%, var(--clr-scrollbar-thumb2, #fc5c7d) 100%);
                            border-radius: 10px;
                            border: 2px solid var(--clr-scrollbar-border, #232a36);
                          }

                          .teacher-list-scroll::-webkit-scrollbar-track,
                          .student-list-scroll::-webkit-scrollbar-track,
                          .branch-list-scroll::-webkit-scrollbar-track {
                            background: var(--clr-scrollbar-track, #232a36);
                            border-radius: 10px;
                          }

                          .teacher-list-scroll,
                          .student-list-scroll,
                          .branch-list-scroll {
                            scrollbar-width: thin;
                            scrollbar-color: var(--clr-scrollbar-thumb1, #6a82fb) var(--clr-scrollbar-track, #232a36);
                          }

                          @media (max-width: 768px) {

                            .teacher-list-scroll,
                            .student-list-scroll,
                            .branch-list-scroll {
                              max-height: 220px;
                              padding: 4px;
                            }
                          }
                        </style>
                      </div>
                      {% endfor %}
                    </div>
                    {% else %}
                    <p class="text-muted small mb-0" style="font-size: 20px; padding-left: 10px;">No students in this
                      branch</p>
                    {% endif %}
                  </div>
                  {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-4" style="color: var(--clr-text-muted);">
                  <p class="mb-2" style="font-size: 13px;">No branches created yet</p>
                  <button class="btn-sm btn-success-custom" style="padding: 6px 14px; font-size: 11px;"
                    onclick="toggleBranchForm('{{ dept.id }}');">
                    Create First Branch
                  </button>
                </div>
                {% endif %}
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
    {% endfor %}
    {% else %}
    <div class="col-12">
      <div class="admin-card text-center py-5">
        <div style="font-size: 48px; margin-bottom: 15px;">üè¢</div>
        <h5 style="color: var(--clr-text); margin-bottom: 10px;">No Departments Yet</h5>
        <p style="color: var(--clr-text-muted); margin-bottom: 20px;">Create your first department using the Quick
          Actions above</p>
      </div>
    </div>
    {% endif %}

  </div>
</div>

<!-- MANAGEMENT LINKS SECTION -->
<div class="container" style="max-width: 1400px; padding-bottom: 50px;">
  <div class="row g-4">
    <div class="col-12">
      <h4 style="color: var(--clr-text); margin-bottom: 20px; font-weight: 600;">üîó Quick Management Links</h4>
    </div>

    <div class="col-lg-4 col-md-6">
      <div class="admin-card" style="height: 100%; transition: transform 0.2s, box-shadow 0.2s;"
        onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 10px 30px rgba(0,0,0,0.3)'"
        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow=''">
        <div class="quick-action-card">
          <div style="font-size: 32px; margin-bottom: 15px;">üè¢</div>
          <h5 style="margin-bottom: 10px;">Manage Departments</h5>
          <p style="color: var(--clr-text-muted); font-size: 13px; margin-bottom: 20px;">
            Configure institution departments and academic units
          </p>
          <a href="{% url 'department_list' %}" class="btn-outline-custom" style="text-decoration: none;">Go to
            Departments ‚Üí</a>
        </div>
      </div>
    </div>

    <div class="col-lg-4 col-md-6">
      <div class="admin-card" style="height: 100%; transition: transform 0.2s, box-shadow 0.2s;"
        onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 10px 30px rgba(0,0,0,0.3)'"
        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow=''">
        <div class="quick-action-card">
          <div style="font-size: 32px; margin-bottom: 15px;">üìö</div>
          <h5 style="margin-bottom: 10px;">Manage Courses</h5>
          <p style="color: var(--clr-text-muted); font-size: 13px; margin-bottom: 20px;">
            Add, edit, or remove courses from your institution
          </p>
          <a href="{% url 'course_list' %}" class="btn-outline-custom" style="text-decoration: none;">Go to Courses
            ‚Üí</a>
        </div>
      </div>
    </div>

    <div class="col-lg-4 col-md-6">
      <div class="admin-card" style="height: 100%; transition: transform 0.2s, box-shadow 0.2s;"
        onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 10px 30px rgba(0,0,0,0.3)'"
        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow=''">
        <div class="quick-action-card">
          <div style="font-size: 32px; margin-bottom: 15px;">üë®‚Äçüè´</div>
          <h5 style="margin-bottom: 10px;">Manage Teachers</h5>
          <p style="color: var(--clr-text-muted); font-size: 13px; margin-bottom: 20px;">
            Add, edit, or remove teachers from your institution
          </p>
          <a href="{% url 'teacher_list' %}" class="btn-outline-custom" style="text-decoration: none;">Go to Teachers
            ‚Üí</a>
        </div>
      </div>
    </div>

    <div class="col-lg-4 col-md-6">
      <div class="admin-card" style="height: 100%; transition: transform 0.2s, box-shadow 0.2s;"
        onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 10px 30px rgba(0,0,0,0.3)'"
        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow=''">
        <div class="quick-action-card">
          <div style="font-size: 32px; margin-bottom: 15px;">üë®‚Äçüéì</div>
          <h5 style="margin-bottom: 10px;">Manage Students</h5>
          <p style="color: var(--clr-text-muted); font-size: 13px; margin-bottom: 20px;">
            Add, edit, or remove students from your institution
          </p>
          <a href="{% url 'student_list' %}" class="btn-outline-custom" style="text-decoration: none;">Go to Students
            ‚Üí</a>
        </div>
      </div>
    </div>

    <div class="col-lg-4 col-md-6">
      <div class="admin-card" style="height: 100%; transition: transform 0.2s, box-shadow 0.2s;"
        onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 10px 30px rgba(0,0,0,0.3)'"
        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow=''">
        <div class="quick-action-card">
          <div style="font-size: 32px; margin-bottom: 15px;">üè´</div>
          <h5 style="margin-bottom: 10px;">Manage Rooms</h5>
          <p style="color: var(--clr-text-muted); font-size: 13px; margin-bottom: 20px;">
            Add, edit, or remove rooms for timetable scheduling
          </p>
          <a href="{% url 'room_list' %}" class="btn-outline-custom" style="text-decoration: none;">Go to Rooms ‚Üí</a>
        </div>
      </div>
    </div>

    <div class="col-lg-4 col-md-6">
      <div class="admin-card" style="height: 100%; transition: transform 0.2s, box-shadow 0.2s;"
        onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 10px 30px rgba(0,0,0,0.3)'"
        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow=''">
        <div class="quick-action-card">
          <div style="font-size: 32px; margin-bottom: 15px;">üìÖ</div>
          <h5 style="margin-bottom: 10px;">Academic Calendar</h5>
          <p style="color: var(--clr-text-muted); font-size: 13px; margin-bottom: 20px;">
            Manage exams, holidays, events & important dates
          </p>
          <a href="{% url 'academic_calendar_list' %}" class="btn-outline-custom" style="text-decoration: none;">Go to
            Calendar ‚Üí</a>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Delete Department Confirmation Modal -->
<div id="deleteDeptModal" class="modal-overlay" style="display: none;">
  <div class="modal-content"
    style="background: var(--clr-surface); border-radius: 16px; padding: 30px; max-width: 500px; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
    <div class="text-center mb-4">
      <div style="font-size: 48px; margin-bottom: 10px;">‚ö†Ô∏è</div>
      <h4 style="color: var(--clr-text); font-weight: 700;">Delete Department?</h4>
    </div>
    <div id="deleteDeptModalBody"
      style="color: var(--clr-text-muted); font-size: 14px; line-height: 1.6; text-align: center; margin-bottom: 25px;">
      <!-- Content populated by JavaScript -->
    </div>
    <div class="d-flex justify-content-center gap-3">
      <button type="button" class="btn-outline-custom" onclick="hideDeleteDeptModal();" style="padding: 10px 25px;">
        Cancel
      </button>
      <form id="deleteDeptForm" method="get" style="display: inline;">
        <button type="submit" class="btn-danger-custom" style="padding: 10px 25px;">
          üóëÔ∏è Yes, Delete Department
        </button>
      </form>
    </div>
  </div>
</div>

<style>
  .modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(5px);
    z-index: 9999;
    display: flex;
    align-items: center;
    justify-content: center;
    animation: fadeIn 0.2s ease-out;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
    }

    to {
      opacity: 1;
    }
  }

  .modal-content {
    animation: slideIn 0.3s ease-out;
  }

  @keyframes slideIn {
    from {
      transform: translateY(-20px);
      opacity: 0;
    }

    to {
      transform: translateY(0);
      opacity: 1;
    }
  }
</style>

<!-- 
====================================================================
                         JAVASCRIPT FUNCTIONALITY
====================================================================
Handles all interactive features:
- Department content toggle (expand/collapse)
- Branch form show/hide
- Delete confirmation modals
- Form submission states
- Smooth animations and transitions
====================================================================
-->
<script>
  /* BRANCH FORM TOGGLE - Shows/hides inline form for adding branches */
  function toggleBranchForm(deptId) {
    const form = document.getElementById('addBranchForm' + deptId);
    if (form.style.display === 'none' || form.style.display === '') {
      form.style.display = 'block';
    } else {
      form.style.display = 'none';
    }
  }

  /* DEPARTMENT TOGGLE - Expands/collapses department content and updates badge text */
  function toggleDepartment(deptId) {
    const content = document.getElementById('deptContent' + deptId);
    const badge = document.getElementById('badge-' + deptId);

    if (content.style.display === 'none' || content.style.display === '') {
      // Expand department content
      content.style.display = 'block';
      badge.textContent = 'Click to Collapse ‚ñ≤';
    } else {
      // Collapse department content
      content.style.display = 'none';
      badge.textContent = 'Click to Expand ‚ñº';
    }
  }

  // Smooth scroll for news list
  document.addEventListener('DOMContentLoaded', function () {
    const newsContainer = document.querySelector('.news-item');
    if (newsContainer) {
      newsContainer.style.animation = 'slideUp 0.6s ease-out';
    }
  });

  // Form submission animation
  const forms = document.querySelectorAll('form');
  forms.forEach(function (form) {
    form.addEventListener('submit', function () {
      const button = this.querySelector('button[type="submit"]');
      if (button) {
        button.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Processing...';
        button.disabled = true;
      }
    });
  });

  /* DELETE BUTTON CLICK - Bridge function to extract data attributes */
  function deleteDeptButtonClick(btn) {
    const deptId = btn.getAttribute('data-dept-id');
    const deptName = btn.getAttribute('data-dept-name');
    const teacherCount = btn.getAttribute('data-teacher-count');
    const branchCount = btn.getAttribute('data-branch-count');
    showDeleteDeptModal(deptId, deptName, teacherCount, branchCount);
  }

  /* DELETE DEPARTMENT MODAL - Shows confirmation dialog with detailed impact information */
  function showDeleteDeptModal(deptId, deptName, teacherCount, branchCount) {
    const modal = document.getElementById('deleteDeptModal');
    const modalBody = document.getElementById('deleteDeptModalBody');
    const form = document.getElementById('deleteDeptForm');

    // Set the form action URL dynamically
    form.action = "{% url 'delete_department' 0 %}".replace('/0/', '/' + deptId + '/');

    // Build detailed warning message about deletion consequences
    let message = `<p><strong>You are about to delete "${deptName}"</strong></p>`;
    message += `<p style="margin-top: 15px;">This action will:</p>`;
    message += `<ul style="text-align: left; margin: 15px auto; max-width: 350px;">`;
    message += `<li>Remove <strong>${teacherCount}</strong> teacher(s) from this department</li>`;
    message += `<li>Remove <strong>${branchCount}</strong> branch(es) from this department</li>`;
    message += `<li><span style="color: var(--clr-danger);">Delete all timetables</span> for this department</li>`;
    message += `<li><span style="color: var(--clr-danger);">Delete all attendance records</span> for this department</li>`;
    message += `</ul>`;
    message += `<p style="color: var(--clr-danger); font-weight: 600;">This action cannot be undone!</p>`;

    modalBody.innerHTML = message;
    modal.style.display = 'flex';

    // Close modal when clicking outside
    modal.onclick = function (e) {
      if (e.target === modal) {
        hideDeleteDeptModal();
      }
    };

    // Enable ESC key to close modal
    document.addEventListener('keydown', handleEscapeKey);
  }

  function hideDeleteDeptModal() {
    const modal = document.getElementById('deleteDeptModal');
    modal.style.display = 'none';
    document.removeEventListener('keydown', handleEscapeKey);
  }

  function handleEscapeKey(e) {
    if (e.key === 'Escape') {
      hideDeleteDeptModal();
    }
  }
</script>

<!-- 
====================================================================
                    ADMIN DASHBOARD SUMMARY
====================================================================
This template provides a comprehensive admin interface with:

MAIN FEATURES:
‚úÖ News Management - Publish, edit, and delete institution announcements
‚úÖ Department Overview - Expandable cards showing teachers and students
‚úÖ Teacher Lists - Scrollable lists with edit links and contact info
‚úÖ Student Management - Organized by branches with academic details
‚úÖ Branch Management - Add branches to departments with inline forms
‚úÖ Delete Protection - Confirmation modals with impact warnings

DESIGN FEATURES:
üé® Theme Support - Automatic light/dark mode adaptation
üé® Custom Scrollbars - Beautiful, theme-aware scrolling containers
üé® Responsive Layout - Mobile-friendly design with breakpoints
üé® Smooth Animations - Fade-in and slide-up effects on load
üé® Glassmorphism Cards - Modern card design with backdrop blur
üé® Consistent Typography - Uses Inter font family throughout

INTERACTIVE ELEMENTS:
üîÑ Collapsible Departments - Click to expand/collapse department details
üîÑ Inline Forms - Add branches without page refresh
üîÑ Hover Effects - Visual feedback on interactive elements
üîÑ Loading States - Form submission indicators
üîÑ Keyboard Support - ESC key closes modals

ACCESSIBILITY:
‚ôø High Contrast - Good color contrast ratios
‚ôø Focus States - Clear focus indicators on interactive elements
‚ôø Semantic HTML - Proper heading structure and labels
‚ôø Screen Reader Friendly - Descriptive text and ARIA attributes
====================================================================
-->
{% endblock %}